///////////////////////////////////////////////////////////////////////////////
//
// Socket
//
///////////////////////////////////////////////////////////////////////////////

//// LIBS /////////////////////////////////////////////////////////////////////

import { connect } from 'socket.io-client';
import { fromBinder } from 'baconjs';
import { TO_CLIENT } from '../../../constants';

//// HELPERS //////////////////////////////////////////////////////////////////

// :: String -> Object
let parseJSON = x => JSON.parse(x);

// :: Socket s -> EventStream of messages from the server
let bindFromServerStream = s => fromBinder(sink => s.on(TO_CLIENT, sink));

///////////////////////////////////////////////////////////////////////////////

const socket = connect(location.href);

//// EXPORTS //////////////////////////////////////////////////////////////////

export const libraryStream = bindFromServerStream(socket)
  .map(parseJSON)
  .map('.library');

///////////////////////////////////////////////////////////////////////////////
